# Water Bot

A Telegram bot that provides information about river water levels in Serbia.
All code generated by [Claude](https://claude.ai).

## Features

- List all available rivers
- Get detailed information about a specific river including:
  - Water level in cm
  - Water level change in cm
  - Discharge in m³/s
  - Water temperature in °C
  - Water level tendency (rising, falling, stable)

## Commands

- `/start` - Start the bot
- `/help` - Show help information
- `/rivers` - Show the list of all available rivers
- `/river [name]` - Show information for a specific river

## Deployment Instructions

### Prerequisites

- Go 1.18 or higher
- A Telegram Bot Token (obtained from [@BotFather](https://t.me/BotFather))
- For automated deployment: A Digital Ocean account and a Droplet

### Local Deployment

1. Clone the repository:
   ```bash
   git clone https://github.com/abelzeko/water-bot.git
   cd water-bot
   ```

2. Install dependencies:
   ```bash
   go mod download
   ```

3. Set the Telegram Bot Token as an environment variable:
   ```bash
   export TELEGRAM_BOT_TOKEN=your_bot_token_here
   ```

4. Run the bot:
   ```bash
   go run main.go
   ```

### Deployment on a Server

For detailed instructions on Digital Ocean deployment, see [Digital Ocean Setup Guide](./docs/digital-ocean-setup.md).

#### Option 1: Building and Running Directly

1. Build the executable:
   ```bash
   go build -o water-bot
   ```

2. Set up the environment variable:
   ```bash
   export TELEGRAM_BOT_TOKEN=your_bot_token_here
   ```

3. Run the bot:
   ```bash
   ./water-bot
   ```

#### Option 2: Using Docker

1. Create a Dockerfile in the project root:
   ```
   FROM golang:1.21-alpine AS build

   WORKDIR /app
   COPY go.mod go.sum ./
   RUN go mod download
   COPY . .
   RUN CGO_ENABLED=0 go build -o water-bot

   FROM alpine:latest
   RUN apk --no-cache add ca-certificates
   WORKDIR /root/
   COPY --from=build /app/water-bot .
   CMD ["./water-bot"]
   ```

2. Build the Docker image:
   ```bash
   docker build -t water-bot .
   ```

3. Run the Docker container:
   ```bash
   docker run -e TELEGRAM_BOT_TOKEN=your_bot_token_here water-bot
   ```

#### Option 3: Using systemd Service (Linux)

1. Build the executable:
   ```bash
   go build -o water-bot
   ```

2. Create a systemd service file at `/etc/systemd/system/water-bot.service`:
   ```
   [Unit]
   Description=Water Bot Telegram Service
   After=network.target

   [Service]
   Type=simple
   User=your_username
   WorkingDirectory=/path/to/water-bot
   ExecStart=/path/to/water-bot/water-bot
   Restart=on-failure
   Environment=TELEGRAM_BOT_TOKEN=your_bot_token_here

   [Install]
   WantedBy=multi-user.target
   ```

3. Reload systemd, enable and start the service:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable water-bot
   sudo systemctl start water-bot
   ```

4. Check the status:
   ```bash
   sudo systemctl status water-bot
   ```

### Keeping the Bot Running

For simple deployment on a VPS or dedicated server, you can use tools like:

- `nohup` to keep the process running after you log out:
  ```bash
  nohup ./water-bot &
  ```
  
- `screen` or `tmux` for session management:
  ```bash
  # Install screen if needed
  sudo apt-get install screen
  
  # Create a new screen session
  screen -S water-bot
  
  # Run the bot
  export TELEGRAM_BOT_TOKEN=your_bot_token_here
  ./water-bot
  
  # Detach from screen (Ctrl+A, then D)
  # Reattach later with: screen -r water-bot
  ```

## Updating

### Manual Updates

1. Pull the latest changes:
   ```bash
   git pull origin main
   ```

2. Rebuild (if using the compiled version):
   ```bash
   go build -o water-bot
   ```

3. Restart the service or container as needed.

### Automated Updates with GitHub Actions

If you're using the Digital Ocean deployment with GitHub Actions:

1. Simply push your changes to the main branch
2. GitHub Actions will automatically:
   - Build a new Docker image
   - Deploy it to your Digital Ocean VPS
   - Restart the container with the updated code

You can check the deployment status in the "Actions" tab of your GitHub repository.

## Troubleshooting

- Check logs if the bot is not responding
- Verify that the Telegram Bot Token is set correctly
- Ensure the bot has internet access to fetch data from the water monitoring website